---
title: PowerApp を使用した階層データのクエリと視覚化 | MicrosoftDocs
description: 階層的な関連するデータのクエリを実行し、視覚化する方法について説明します
ms.custom: ''
ms.date: 06/20/2018
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 (online)
- Dynamics 365 Version 9.x
- powerapps
author: Mattp123
ms.assetid: 0cf62817-5ff5-40bb-ad17-e1f6b0921720
caps.latest.revision: 42
ms.author: matp
manager: kvivek
ms.openlocfilehash: ec45f43266c1920d05301c92bdd67838b40b7734
ms.sourcegitcommit: aba996b1773ecdf62758e06b34eaf57bede29e08
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/08/2018
ms.locfileid: "39691174"
---
# <a name="query-and-visualize-hierarchically-related-data"></a>階層的に関連するデータのクエリと視覚化

階層的に関連するデータを視覚化することで、貴重なビジネスの分析情報を取得できます。 階層モデリングおよび視覚化機能にはさまざまな利点があります。  
  
-   複雑な階層情報を表示および探索します。  
  
-   階層のコンテキスト ビューで、主要業績評価指標 (KPI) を表示します。  
  
-   Web およびタブレットにわたって重要な情報を視覚的に分析します。  
  
アカウントやユーザーなど、一部のエンティティには組み込みの視覚化が用意されています。 カスタム エンティティを含むその他のエンティティは、階層に対して有効化でき、それらの視覚エフェクトを作成できます。 必要に応じて、階層全体を表示するツリー ビューを使用するか、階層のより小さい部分を示すタイル ビューを使用するかを選択できます。 両方のビューは左右に並べて表示されます。 階層ツリーを展開し、折りたたんで階層を探索できます。 視覚化に同じ階層設定を一度設定すると、Web クライアントとモバイル クライアントの両方に適用されます。 タブレットの場合、小さいフォーム ファクターに合わせて変更された形式でビジュアルがレンダリングされます。 階層的な視覚化に必要なカスタマイズ可能なコンポーネントはソリューション対応なので、他のカスタマイズと同様に組織間で移動できます。 視覚化に表示される属性は、フォーム エディターを使用して簡易入力フォームをカスタマイズすることで構成できます。 コードを記述する必要はありません。  
  
<a name="BKMK_Querydata"></a>   
## <a name="query-hierarchical-data"></a>階層データのクエリを実行する  
 Common Data Service for Apps では、関連レコードの自己参照型一対多 (1:N) リレーションシップによって階層データ構造がサポートされています。 以前は、階層データを表示するには関連レコードに対してクエリを繰り返し実行する必要がありました。 現在は、1 つの手順で階層として関連データのクエリを実行できます。 **[未満]** および **[以下]** ロジックを使用して、レコードのクエリを実行することができます。 **Under** および **Not Under** 階層演算子は、高度な検索とワークフロー エディターで公開されています。 これらの演算子の使用方法の詳細については、[ワークフロー ステップの構成](/flow/configure-workflow-steps)に関するページを参照してください。 高度な検索の詳細については、「[高度な検索の作成、編集または保存](https://docs.microsoft.com/dynamics365/customer-engagement/basics/save-advanced-find-search)」を参照してください。  
  
 次の例では、階層のクエリを実行するさまざまなシナリオを示します。  
  
 アカウント階層のクエリ  
  
 ![アカウント階層内のアカウントのクエリ](media/query-accounts.png "アカウント階層内のアカウントのクエリ")  
  
 関連アクティビティを含むアカウント階層のクエリ  
  
 ![アカウントの関連アクティビティのクエリ](media/query-account-related-activities.png "アカウントの関連アクティビティのクエリ")  
  
 関連する営業案件を含むアカウント階層のクエリ  
  
 ![アカウントの関連する営業案件のクエリ](media/query-account-related-opportunities.png "アカウントの関連する営業案件のクエリ")  
  
 データを階層としてクエリを実行するには、エンティティの自己参照型一対多 (1:N) リレーションシップのいずれかを階層として設定する必要があります。 階層を有効にするには、次の手順に従います。  
  
1.  [ソリューション エクスプローラー](../model-driven-apps/advanced-navigation.md#solution-explorer)を開きます。 
  
2.  目的のエンティティを選択し、**[1:N リレーションシップ]** を選択し、(1:N) の関連付けを選択します。 

3.  **[Relationship definition]/(リレーションシップの定義/)** で、**[Hierarchical]/(階層/)** を **[はい]** に設定します。  
  
> [!NOTE]
> - 一部の標準の (1: N) リレーションシップはカスタマイズできません。 これらのリレーションシップを階層として設定できなくなります。  
> - システムの自己参照型リレーションシップに対して、階層リレーションシップを指定できます。 これには、"contact_master_contact" リレーションシップなど、システムの種類の 1:N 自己参照型リレーションシップが含まれます。  
  
<a name="BKMK_Visualizedata"></a>   
## <a name="visualize-hierarchical-data"></a>階層データの視覚化  
 組み込みの視覚化が用意されているシステム エンティティには、`Account`、`Position`、`Product`、`User` などがあります。 これらのエンティティのグリッド ビューでは、レコード名の左側に階層グラフを示すアイコンが表示されます。 既定では、階層アイコンが表示されないレコードがあります。 親レコード、子レコード、またはその両方を持つレコードのアイコンが表示されます。  
  
 ![アクティブなアカウント](media/cust-hs-active-account.png "アクティブなアカウント")  
  
 階層アイコンを選択すると、下図のように、左側にツリー ビュー、右側にタイル ビューという階層が表示されます。  
  
 ![アカウントのツリー ビューとタイル ビュー](media/hierachy-security-accounts-tile-view.png "アカウントのツリー ビューとタイル ビュー")  
  
 1 つの階層にその他の組み込みのシステム エンティティを有効にすることができます。 たとえば、`Case`、`Contact`、`Opportunity`、`Order`、`Quote`、`Campaign`、`Team` などのエンティティです。 1 つの階層にすべてのカスタム エンティティを有効にすることができます。  
  
> [!TIP]
>  1 つの階層に 1 つのエンティティを有効にすることができる場合:  
>  ソリューション エクスプローラーで目的のエンティティを展開します。 **[階層設定]** というエンティティ コンポーネントが表示されます。 階層に対して有効にすることができないエンティティにはこのコンポーネントが含まれませんが、Dynamics 365 ユーザー エンゲージメントの [営業担当地域] エンティティは例外です。 [営業担当地域] エンティティの場合に **[階層設定]** は表示されますが、階層に対してそのエンティティを有効にすることはできません。  
  
 視覚化の作成時に注意する必要がある重要事項:  
  
-   エンティティごとに 1 つの (1:N) 自己参照型リレーションシップのみを階層として設定できます。 このリレーションシップでは、プライマリ エンティティと関連エンティティは、account_parent_account や new_new_widget_new_widget など、同じ種類である必要があります。  
  
-   現在、階層または視覚化は、1 つのエンティティのみに基づいています。 複数のレベルのアカウントを表示するアカウント階層を表現できますが、アカウントと連絡先を同じ階層の視覚化で表示することはできません。  
  
-   1 つのタイルに表示できるフィールド数の上限は 4 つです。 タイル ビューに使用するフィールドを簡易入力フォームに追加すると、最初の 4 つのフィールドのみが表示されます。  
  
### <a name="visualization-example"></a>視覚化の例  
 カスタム エンティティの視覚化を作成する例を見てみましょう。 ここでは、次のように new_Widget というカスタム エンティティを作成し、(1:N) 自己参照型リレーションシップ **new_new_widget_new_widget** を作成し、階層としてマークしました。  
  
 ![ウィジェットのリレーションシップの定義](media/widget-relationship-definition.png "ウィジェットのリレーションシップの定義")  
  
 次に、**[階層設定]** グリッド ビューで、**new_new_widget_new_widget** 階層リレーションシップを選択しました。 フォームの必須フィールドに入力しました。 まだ (1:N)リレーションシップを階層としてマークしていない場合、フォーム上のリンクをクリックすると、リレーションシップの定義フォームに戻ります。ここでリレーションシップを階層としてマークできます。  
  
 **[簡易表示フォーム]** については、**Widget Hierarchy Tile Form** という簡易入力フォームを作成しました。 このフォームには、各タイルに表示する 4 つのフィールドを追加しました。  
  
 ![ウィジェットの簡易入力フォームの作成](media/create-quickf-orm.png "ウィジェットの簡易入力フォームの作成")  
  
 設定が完了した後は、Standard ウィジェットと Premium ウィジェットの 2 つのレコードを作成しました。 ルックアップ フィールドを使用して Premium ウィジェットを Standard ウィジェットの親にした後、new_Widget グリッド ビューには次のように階層アイコンが表示されます。  
  
 ![ウィジェットの階層グリッド](media/widget-hierarchy-grid.png "ウィジェットの階層グリッド")  
  
> [!TIP]
>  レコードが親子リレーションシップでペアリングされるまで、レコード グリッド ビューに階層アイコンは表示されません。  
  
 階層アイコンを選択すると、左側にツリー ビュー、右側にタイル ビューという new_Widget 階層が表示され、2 つのレコードが表示されます。 各タイルには、**Widget Hierarchy Tile Form** で指定した 4 つのフィールドがあります。  
  
 ![ウィジェットのツリー ビューとタイル ビュー](media/widget-tree-tiles.png "ウィジェットのツリー ビューとタイル ビュー")  
  
## <a name="see-also"></a>関連項目  
 [ビデオ: 階層セキュリティ モデリング](http://www.youtube.com/watch?v=kx5So32DrCo&index=10&list=PLC3591A8FE4ADBE07)   
 [ビデオ: 階層の視覚化](http://www.youtube.com/watch?v=_dGBE6icLNw&index=9&list=PLC3591A8FE4ADBE07)
