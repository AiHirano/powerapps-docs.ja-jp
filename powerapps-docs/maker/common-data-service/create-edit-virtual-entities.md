---
title: Common Data Service for Apps で仮想エンティティを作成および編集する | MicrosoftDocs
description: 仮想エンティティを作成する方法について説明します
ms.custom: ''
ms.date: 06/27/2018
ms.reviewer: ''
ms.service: crm-online
ms.suite: ''
ms.tgt_pltfrm: ''
ms.topic: article
applies_to:
- Dynamics 365 (online)
- Dynamics 365 Version 9.x
- powerapps
ms.assetid: 44834893-0bf6-4a64-8f06-7583fe08330d
caps.latest.revision: 11
author: Mattp123
ms.author: matp
manager: kvivek
ms.openlocfilehash: 675c0ac5763698c82a7d13bfc75f8b7357d6cf0b
ms.sourcegitcommit: aba996b1773ecdf62758e06b34eaf57bede29e08
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/08/2018
ms.locfileid: "39691054"
---
# <a name="create-and-edit-virtual-entities-that-contain-data-from-an-external-data-source"></a>外部データ ソースからのデータを含む仮想エンティティを作成および編集する

仮想エンティティは、外部データ ソースからのデータを含むフィールドがある、Common Data Service for Apps のカスタム エンティティです。 仮想エンティティはアプリで通常のエンティティ レコードとしてユーザーに表示されますが、Azure SQL Database など、外部データベースからのデータを含みます。 仮想エンティティに基づくレコードは、CDS for Apps Web サービスを使用して開発されたカスタム クライアントを含むすべてのクライアントで利用できます。  
  
以前は、異種のデータ ソースを統合するには、サーバー側またはクライアント側で、データの移行またはカスタム プラグインの開発のためにコネクタを作成する必要がありました。 しかし、仮想エンティティを使用して、実行時に外部データ ソースに直接接続できるので、データをレプリケーションしなくても外部データ ソースからの特定のデータを環境内で利用することができます。  

仮想エンティティは、*データ プロバイダー*、*データ ソース* レコード、*仮想エンティティ*という 3 つの主要なコンポーネントで構成されます。 データ プロバイダーは、プラグインとデータ ソース エンティティで構成されます。 データ ソースは、接続パラメーターのスキーマを表すメタデータを含む、CDS for Apps 内のエンティティ レコードです。 各仮想エンティティでは、エンティティ定義のデータ ソースを参照します。  
  
CDS for Apps には、外部データにアクセスする OData v4 Web サービスとの接続に使用できる OData データ プロバイダーが含まれています。 
  
開発者は、独自のデータ プロバイダーをビルドすることもできます。 データ プロバイダーは、ソリューションとして環境にインストールされます。 詳細情報: [開発者ドキュメント: 仮想エンティティに関する入門情報](/dynamics365/customer-engagement/developer/virtual-entities/get-started-ve)
  
 ![仮想エンティティの図](media/virtual-entity-diagram.png "仮想エンティティの図")  
  
<a name="benefits"></a> 
  
## <a name="virtual-entity-benefits"></a>仮想エンティティの利点  
  
- 開発者は、CDS for Apps Web サービスとプラグイン登録ツールを使用して、外部データを読み取るためのプラグインを実装できます。  
- システム カスタマイザーは PowerApps ソリューション エクスプローラーを使用して、データ ソース レコードを構成し、コードを記述することなく、外部データへのアクセスに使用される仮想エンティティを作成します。  
- エンドユーザーは、仮想エンティティによって作成されたレコードを操作して、フィールド、グリッド、検索結果、Fetch XML ベースのレポートとダッシュボードのデータを表示します。  
  
<a name="AddDataSource"></a> 
  
## <a name="add-a-data-source-to-use-for-virtual-entities"></a>仮想エンティティで使用するデータ ソースを追加する 
 
 開発者は、仮想エンティティのデータ プロバイダーとして使用するカスタム プラグインを作成します。 提供される OData v4 データ プロバイダーを使用することもできます。 詳細情報: [OData v4 データ プロバイダーの構成、要件、ベスト プラクティス](virtual-entity-odata-provider-requirements.md)  
  
1. **[[設定]](../model-driven-apps/advanced-navigation.md#settings)** > **[管理]** > **[仮想エンティティ データ ソース]** の順に移動します。  
1. 操作ツールバーで、**[新規]** を選択します。  
1. **[データ プロバイダーの選択]** ダイアログ ボックスで、次のデータ ソースから選び、**[OK]** を選択します。
 
    |データ プロバイダー|説明|
    |--|--|
    |*カスタム データ プロバイダー*|データ プロバイダー プラグインをインポートした場合は、ここにデータ プロバイダーが表示されます。 詳細情報: [開発者ドキュメント: 仮想エンティティに関する入門情報](/dynamics365/customer-engagement/developer/virtual-entities/get-started-ve)|
    |**OData v4 データ プロバイダー**|CDS for Apps には、OData v4 Web サービスで使用できる OData データ プロバイダーが含まれています。 詳細情報: [OData v4 データ プロバイダーの構成、要件、ベスト プラクティス](virtual-entity-odata-provider-requirements.md)|

  
### <a name="add-a-secured-field-to-a-data-source"></a>データ ソースにセキュリティで保護されたフィールドを追加する

他のエンティティと同じ方法でデータ ソースのフィールドを作成します。 暗号化されたデータまたは機密データの場合、データ ソースのカスタム フィールドでデータ ソース シークレット属性を有効にします。 たとえば、データベース接続文字列を含むフィールドをセキュリティで保護する場合です。 

> [!NOTE]
> データ ソース シークレット属性は、データ ソース フォームに追加されたフィールドでのみ使用できます。

![データ ソース シークレット属性](media/datasourcesecret.png)
  
<a name="createVirtualEntity"></a> 
  
## <a name="create-a-virtual-entity"></a>仮想エンティティを作成する
  
仮想エンティティは、ここで説明したいくつかの追加の属性はありますが、CDS for Apps の他のエンティティと同様に作成できます。 仮想エンティティは、ソリューション エクスプローラーを使用して作成する必要があります。

> [!NOTE]
>  データ ソースとして **[なし]** を選択して仮想エンティティを作成することはできますが、データを取得するには、仮想エンティティにデータ ソースが必要になります。 詳細情報: [仮想エンティティで使用するデータ ソースを追加する](#AddDataSource)

### <a name="open-solution-explorer"></a>ソリューション エクスプローラーを開く

作成する仮想エンティティの名前の一部は、カスタマイズの接頭辞です。 これは、使用中のソリューションのソリューション発行元に基づいて設定されます。 カスタマイズの接頭辞が重要であれば、カスタマイズの接頭辞がこの仮想エンティティに必要な接頭辞になる、アンマネージド ソリューションを使用していることを確認してください。 詳細: [既定の発行者のソリューション発行者の接頭辞を変更する](change-solution-publisher-prefix.md) 

[!INCLUDE [cc_navigate-solution-from-powerapps-portal](../../includes/cc_navigate-solution-from-powerapps-portal.md)]

### <a name="create-a-virtual-entity"></a>仮想エンティティを作成する
  
1. ソリューション エクスプローラーで、新しいエンティティを作成します。 これを行うには、左側のナビゲーション ウィンドウで **[エンティティ]** を選択してから、**[新規]** を選びます。  
2. **[エンティティ定義]** の **[全般]** タブで、**[仮想エンティティ]** を選択し、**[データ ソース]** ドロップダウン リストで、目的のデータ ソースを選びます。  
  
    ![エンティティ定義の仮想エンティティ オプション](media/virtual-entity-click-option.png)  
  
1. [エンティティ定義] では、次の必須フィールドに入力します。
  
    |フィールド|説明|
    |--|--|
    |**外部名**|このエンティティがマッピングされる、外部データ ソース内のテーブルの名前を入力します。|
    |**外部コレクション名**|このエンティティがマッピングされる、外部データ ソース内のテーブルの複数名を入力します。|
      
    ドキュメント ファイルにアクセスするために Azure Cosmos DB データ プロバイダーを使用する *Movie* という名前の仮想エンティティの例を以下に示します。  
      
    ![Azure Cosmos DB データ プロバイダーを使用する仮想エンティティ定義](media/virtual-entity-definition.PNG)  
      
    > [!IMPORTANT]
    > 仮想エンティティでは、アクセス チーム、キュー、簡易作成などのいくつかのオプションを使用することはできません。 詳細情報: [仮想エンティティを使用する際の考慮事項](#considerations)  
      
    必要に応じて、表示名や複数名など、他の必須プロパティと省略可能なプロパティを入力します。 これらのプロパティの詳細については、[エンティティの作成と編集](create-edit-entities.md)に関するページを参照してください。  
  
1. 仮想エンティティに対して 1 つ以上のフィールドを作成および追加します。 カスタム フィールドを作成するために必要な標準のフィールド プロパティに加え、これらの省略可能なプロパティは、仮想エンティティに対して作成する各カスタム フィールドで利用できます。

    |フィールド|説明|
    |--|--|
    |**外部名**|これは通常、フィールドに表示するデータを識別するための一意の名前です。|
    |**外部の種類の名前**|作成するフィールドの種類が OptionSet である場合: このプロパティは、オプション セットに対する外部サービス内の値セットの外部名にマッピングされます。  通常、これは文字列値クラスの列挙値または名前となります。 完全修飾名が必要な場合は、外部の種類の名前を使用できます。  たとえば、クエリのパラメーターに [*種類の名前*].[*値*] などの完全修飾名を必要とする OData で *種類の名前* として使用できます。|
    |**外部値**|作成するフィールドの種類が OptionSet である場合: このプロパティは、オプション セット項目用の外部データ ソース内の対応する値にマッピングされます。  入力されたこの値を使用して、アプリに表示するオプション セット項目が決定されます。  |

    必要に応じて、他のプロパティを入力します。 これらのプロパティの詳細については、[フィールドの作成と編集](create-edit-fields.md)に関するページを参照してください。  
  
1. **[フィールド]** プロパティ ページで **[保存して閉じる]** を選択します。  
1. ソリューション エクスプローラーのツールバーで、**[保存]** を選択します。  
1. ソリューション エクスプローラーのツールバーで、**[公開]** を選択します。  
1. ソリューション エクスプローラーを閉じます。  

<a name="considerations"></a>
   
## <a name="considerations-when-you-use-virtual-entities"></a>仮想エンティティを使用する際の考慮事項  

仮想エンティティには次の制限事項があります。  
  
- すべての仮想エンティティは読み取り専用です。  
- 既存のエンティティを仮想エンティティに変換することはできません。  
- 既定では、仮想エンティティには名前および ID フィールドのみが含まれます。  状態や作成日/変更日など、他のシステム管理フィールドはサポートされていません。
- 仮想エンティティでは、データの種類が通貨、イメージ、顧客のカスタム フィールドはサポートされません。
- 仮想エンティティでは監査はサポートされません。  
- 仮想エンティティ フィールドをロールアップや計算フィールドで使用することはできません。
- 仮想エンティティを、エンティティのアクティビティの種類にすることはできません。  
- 仮想エンティティでは、エンティティ テーブル行に影響する多くの機能を有効にすることはできません。  例として、キュー、ナレッジ マネージメント、SLA、重複データ検出、変更の追跡、Mobile Offline 機能、フィールド セキュリティ、関連性検索、Dynamics 365 Web ポータル ソリューションのポータル、仮想エンティティ間の N:N のリレーションシップなどがあります。  
- 仮想エンティティは組織によって所有され、行レベルの Common Data Service for Apps セキュリティ概念はサポートされません。 外部データ ソースには独自のセキュリティ モデルを実装することをお勧めします。  
- 高度な検索で仮想エンティティを使用する場合は、単一のデータ ソースを対象とすることをお勧めします。 たとえば、Common Data Service for Apps のネイティブ データと仮想エンティティの外部データの間に最終的に結合を作成する、高度な検索の作成はサポートされません。  
- 更新時に確認されるフィールド メタデータ プロパティは、仮想エンティティには適用されません。 たとえば、仮想エンティティ フィールドの整数フィールドには、最小値の 0 に設定できます。 しかし、値は外部データ ソースから取得されるため、仮想エンティティから取得した場合、クエリで 0 未満の値が返されます。  クエリでは最小値のプロパティは暗黙に示されません。  0 を超える値が望ましい場合は、値をそのようにフィルター処理する必要があります。
- 仮想エンティティでは変更の追跡はサポートされておらず、データ エクスポート サービスなどの CDS for Apps の機能を使用して同期することはできません。
  
### <a name="see-also"></a>関連項目  

[OData v4 データ プロバイダーの要件とベスト プラクティス](virtual-entity-odata-provider-requirements.md)</br> 
[エンティティの作成と編集](create-edit-entities.md)</br>
[フィールドの作成と編集](create-edit-fields.md)
